<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ochin Pakhi</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@100&display=swap" rel="stylesheet">
  <style>
    /* Add your additional styles here */
  </style>
</head>

<body>
  <header>
    <h1>Welcome To Ochin Pakhi</h1>
    <div class="hamburger">&#9776;</div>
    <nav class="mobile-nav">
      <ul>
        <li><a href="index.html" class="nav-button">Home</a></li>
        <li><a href="performance.html" class="nav-button">Performances</a></li>
        <li><a href="photos.html" class="nav-button">Photos</a></li>
        <li><a href="events.html" class="nav-button">Events</a></li>
        <li><a href="contact.html" class="nav-button">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h2>Newest Event</h2>
    <div class="index"></div>

    <h2>About Us</h2>
    <p>
      Ochin Pakhi, a Bengali music band from Chicago, is a group of spiritually motivated, fun-loving musicians who perform
      different styles of folk songs from West Bengal and Bangladesh.
      "Ochin Pakhi" (অচিন পাখি) is a Bengali phrase that translates to “The unknown bird” and refers to the heart. This
      phrase was first used by Lalon Fakir (Shah), a prominent Bengali philosopher, Baul saint, mystic, songwriter, and
      social reformer, in one of his famous songs “Khachar Bhitor Ochin Pakhi” (খাঁচার ভিতর অচিন পাখি).
    </p>

    <div class="image-container">
      <img src="/assets/folkinstru.png" alt="Folk Instruments">
    </div>

    <p>
      Ochin Pakhi performs folk songs from West Bengal, India, and Bangladesh; they have performed: Rabindra Sangeet (Songs
      of Rabindranath Tagore), Nazrul Geeti (Songs of Kazi Nazrul Islam), Baul-Fakiri (the traditional songs of the Baul-Fakir
      community in Bengal), Bhatiyali (boatman songs), Jhumur (melodies from the western part of Bengal), and original compositions.
      Pieces are performed with ethnic instruments, including ektara, dubki, khol, tabla, manjira, khamak, bansuri, dholak,
      banjo, and other drums.
      The mission of Ochin Pakhi is to present songs with colorful melodies and eclectic rhythm from greater Bengal to the world.
      Its members are intensely collaborative and create a cross-cultural platform. Ochin Pakhi is an endless journey of music: on
      one hand, it bears strong tradition, and on the other, it carries forth beyond all cultural boundaries.
    </p>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const hamburger = document.querySelector('.hamburger');
      const mobileNav = document.querySelector('.mobile-nav');

      hamburger.addEventListener('click', function () {
        mobileNav.classList.toggle('show');
      });
    });

    window.addEventListener("DOMContentLoaded", async function () {
      const apiToken = await getApiToken();
      let order = 1;
      let fetchedEvent = false; // Track whether an event has been fetched

      async function fetchNewestEvent() {
        if (!fetchedEvent) {
          console.log("Fetching data for order", order, "...");
          try {
            const newestEvent = await sendAPIRequest(order, apiToken);
            if (newestEvent) {
              console.log("Title:", newestEvent.title);
              console.log("Published At:", newestEvent.publishedAt);
              console.log("Timing:", newestEvent.timing);
              console.log("Description:", newestEvent.description);
              console.log("URL:", newestEvent.url);
              renderEvent(newestEvent);
              fetchedEvent = true; // Set fetchedEvent to true after successfully fetching an event
              console.log("Data fetched successfully for order", order, "!");
            } else {
              order++;
              fetchNewestEvent();
            }
          } catch (error) {
            console.error("Error fetching event for order", order, ":", error);
            order++;
            fetchNewestEvent();
          }
        }
      }

      function renderEvent(event) {
        const indexDiv = document.querySelector('.index');
        indexDiv.innerHTML = '';

        const { title, publishedAt, timing, description, url } = event;

        const newDiv = document.createElement('div');
        newDiv.classList.add('content');
        newDiv.innerHTML = `<h4>${title}</h4>`;

        const timingPre = document.createElement('pre');
        timingPre.textContent = `Timing: ${publishedAt}`;
        timingPre.style.textAlign = 'center';

        const descriptionPre = document.createElement('pre');
        descriptionPre.textContent = `Description: ${description}`;
        descriptionPre.style.textAlign = 'justify';
        descriptionPre.style.textJustify = 'inter-word';

        if (url) {
          const image = document.createElement('img');
          image.src = url;
          image.alt = "Event Poster";
          newDiv.appendChild(image);
        }

        newDiv.appendChild(timingPre);
        newDiv.appendChild(descriptionPre);

        indexDiv.appendChild(newDiv);
      }

      async function getApiToken() {
        const tokenResponse = await fetch('/api');
        const token = await tokenResponse.text();
        return token.trim();
      }

      async function sendAPIRequest(order, token) {
        const url = `https://strapi-ru2c.onrender.com/api/events/${order}?populate=poster`; // Updated API endpoint
        const options = {
          method: "GET",
        };

        try {
          const response = await fetch(url, options);

          if (response.ok) {
            const json = await response.json();
            const title = json.data.attributes.Name;
            const publishedAt = json.data.attributes.publishedAt;
            const timing = json.data.attributes.Timing; // Additional JSON data
            const description = json.data.attributes.description; // Additional JSON data
            const url = json.data.attributes.poster?.data?.attributes.url || '';

            return {
              title,
              publishedAt,
              timing,
              description,
              url
            };
          } else if (response.status === 404) {
            console.error("API request failed for order", order, ". Error:", response.status);
          } else {
            console.error("API request failed for order", order, ". Error:", response.status);
          }
        } catch (error) {
          console.error("API request failed for order", order, ". Error:", error);
        }
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        const day = date.getDate();
        const month = date.getMonth() + 1;
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }

      fetchNewestEvent(); // Fetch the newest event on page load
    });

    function adjustSizes() {
      const screenWidth = window.innerWidth;
      const header = document.querySelector('header');
      const headerH1 = document.querySelector('header h1');
      const hamburger = document.querySelector('.hamburger');
      const mobileNav = document.querySelector('.mobile-nav');

      if (screenWidth <= 600) {
        // Adjust text size for smaller screens
        document.body.style.fontSize = '14px';

        // Adjust header styles for smaller screens
        header.style.padding = '20px';
        header.style.height = '100px';

        // Adjust header h1 styles for smaller screens
        headerH1.style.fontSize = '1.5em';
        headerH1.style.marginBottom = '10px';

        // Adjust mobile navigation styles for smaller screens
        mobileNav.style.top = '50px';
        mobileNav.style.right = '5px';
        mobileNav.style.width = '160px';
      } else {
        // Reset to default text and element sizes for larger screens
        document.body.style.fontSize = '16px';

        // Reset header styles for larger screens
        header.style.padding = '50px';
        header.style.height = 'auto';

        // Reset header h1 styles for larger screens
        headerH1.style.fontSize = '2em';
        headerH1.style.marginBottom = '10px';

        // Hide mobile navigation for larger screens
        mobileNav.classList.remove('show');
      }
    }

    // Call the adjustSizes() function on page load
    window.addEventListener('DOMContentLoaded', adjustSizes);

    // Call the adjustSizes() function whenever the window is resized
    window.addEventListener('resize', adjustSizes);
  </script>
</body>

</html>
